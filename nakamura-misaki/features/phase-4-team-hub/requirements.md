# Phase 4: Team Hub - Requirements

## Overview

ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ãƒ»ãƒãƒ³ãƒ‰ã‚ªãƒ•ã‚’å¯è¦–åŒ–ã™ã‚‹Admin UIã‚’å®Ÿè£…ã™ã‚‹ã€‚nakamura-misakiãŒãƒãƒ¼ãƒ ã®çŠ¶æ³ã‚’æŠŠæ¡ã—ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## User Stories

### Story 1: ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§

**As a** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
**I want** ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèªã§ãã‚‹
**So that** ãƒãƒ¼ãƒ ã®çŠ¶æ³ã‚’æŠŠæ¡ã§ãã‚‹

**Acceptance Criteria**:
- [ ] `@ä¸­æ‘ç¾å’² ãƒãƒ¼ãƒ ã®ã‚¿ã‚¹ã‚¯` ã§ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
- [ ] ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã‚‹
- [ ] æœŸé™é †ã«ä¸¦ã¶
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**Example**:
```
User: @ä¸­æ‘ç¾å’² ãƒãƒ¼ãƒ ã®ã‚¿ã‚¹ã‚¯
nakamura-misaki:
  ğŸ“Š ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ï¼ˆ8ä»¶ï¼‰

  é‡å£å‡œ (3ä»¶):
  - [abc12345] APIçµ±åˆãƒ†ã‚¹ãƒˆ (ä»Šæ—¥15:00) â–¶ï¸
  - [def67890] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–° (ä»Šæ—¥18:00) â¸ï¸
  - [ghi11111] ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ (æœŸé™ãªã—) â¸ï¸

  ç”°ä¸­å¤ªéƒ (2ä»¶):
  - [jkl22222] DBç§»è¡Œ (æ˜æ—¥10:00) â–¶ï¸
  - [mno33333] UIæ”¹å–„ (æ˜å¾Œæ—¥16:00) â¸ï¸

  ä½è—¤èŠ±å­ (3ä»¶):
  - [pqr44444] ãƒ†ã‚¹ãƒˆå®Ÿè£… (ä»Šæ—¥17:00) â–¶ï¸
  - [stu55555] è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ (æ˜æ—¥14:00) â¸ï¸
  - [vwx66666] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ (æ¥é€±) â¸ï¸
```

### Story 2: ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡º

**As a** nakamura-misaki
**I want** ã‚¿ã‚¹ã‚¯ã®åã‚Šã‚’æ¤œå‡ºã§ãã‚‹
**So that** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã‚¢ãƒ©ãƒ¼ãƒˆã§ãã‚‹

**Acceptance Criteria**:
- [ ] 1äººã«5ä»¶ä»¥ä¸Šã‚¿ã‚¹ã‚¯ãŒé›†ä¸­ã—ãŸã‚‰è­¦å‘Š
- [ ] æœŸé™åˆ‡ã‚Œã‚¿ã‚¹ã‚¯ãŒã‚ã£ãŸã‚‰è­¦å‘Š
- [ ] é€²è¡Œä¸­ã‚¿ã‚¹ã‚¯ãŒé•·æœŸé–“æ›´æ–°ã•ã‚Œã¦ã„ãªã‹ã£ãŸã‚‰è­¦å‘Š

**Example**:
```
nakamura-misaki (è‡ªç™ºçš„ã«DM):
  âš ï¸ ã‚¿ã‚¹ã‚¯ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡º

  é‡å£å‡œã•ã‚“ã«ã‚¿ã‚¹ã‚¯ãŒé›†ä¸­ã—ã¦ã„ã¾ã™ï¼ˆ5ä»¶ï¼‰ã€‚
  ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã«åˆ†æ•£ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

  æœŸé™åˆ‡ã‚Œã‚¿ã‚¹ã‚¯:
  - [abc12345] APIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆæœŸé™: æ˜¨æ—¥15:00ï¼‰

  é•·æœŸåœæ»ã‚¿ã‚¹ã‚¯ï¼ˆ3æ—¥ä»¥ä¸Šæ›´æ–°ãªã—ï¼‰:
  - [ghi11111] ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œï¼ˆé‡å£å‡œï¼‰
```

### Story 3: Admin UI

**As a** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
**I want** Web UIã§ãƒãƒ¼ãƒ å…¨ä½“ã‚’ç¢ºèªã§ãã‚‹
**So that** Slackã‚’é–‹ã‹ãªãã¦ã‚‚çŠ¶æ³ã‚’æŠŠæ¡ã§ãã‚‹

**Acceptance Criteria**:
- [ ] `/admin` ã§Web UIè¡¨ç¤º
- [ ] ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§
- [ ] ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ã‚¿ã‚¹ã‚¯æ•°ã‚°ãƒ©ãƒ•
- [ ] æœŸé™åˆ¥ã‚¿ã‚¹ã‚¯æ•°ã‚°ãƒ©ãƒ•
- [ ] ãƒãƒ³ãƒ‰ã‚ªãƒ•ä¸€è¦§

**UI Mockup**:
```
+-----------------------------------+
| nakamura-misaki Admin             |
+-----------------------------------+
| [Dashboard] [Tasks] [Handoffs]    |
+-----------------------------------+

Dashboard:
- ãƒãƒ¼ãƒ å…¨ä½“: 8ã‚¿ã‚¹ã‚¯
- ä»Šæ—¥æœŸé™: 3ã‚¿ã‚¹ã‚¯
- æœŸé™åˆ‡ã‚Œ: 1ã‚¿ã‚¹ã‚¯
- ãƒãƒ³ãƒ‰ã‚ªãƒ•äºˆå®š: 2ä»¶

[ã‚°ãƒ©ãƒ•] ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ã‚¿ã‚¹ã‚¯æ•°
é‡å£å‡œ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3ä»¶
ç”°ä¸­å¤ªéƒ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 2ä»¶
ä½è—¤èŠ±å­: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3ä»¶

[ã‚°ãƒ©ãƒ•] æœŸé™åˆ¥ã‚¿ã‚¹ã‚¯æ•°
ä»Šæ—¥: â–ˆâ–ˆâ–ˆ 3ä»¶
æ˜æ—¥: â–ˆâ–ˆ 2ä»¶
ä»Šé€±: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 5ä»¶
```

### Story 4: ãƒãƒ¼ãƒ çµ±è¨ˆ

**As a** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
**I want** ãƒãƒ¼ãƒ ã®ã‚¿ã‚¹ã‚¯å®Œäº†ç‡ãƒ»ãƒãƒ³ãƒ‰ã‚ªãƒ•å›æ•°ã‚’ç¢ºèªã§ãã‚‹
**So that** ãƒãƒ¼ãƒ ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è©•ä¾¡ã§ãã‚‹

**Acceptance Criteria**:
- [ ] é€±æ¬¡ã‚¿ã‚¹ã‚¯å®Œäº†ç‡
- [ ] ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ã‚¿ã‚¹ã‚¯å®Œäº†æ•°
- [ ] ãƒãƒ³ãƒ‰ã‚ªãƒ•å›æ•°ï¼ˆé€±æ¬¡ï¼‰
- [ ] å¹³å‡ã‚¿ã‚¹ã‚¯æ‰€è¦æ™‚é–“

**Example**:
```
User: @ä¸­æ‘ç¾å’² ä»Šé€±ã®çµ±è¨ˆ
nakamura-misaki:
  ğŸ“ˆ ä»Šé€±ã®çµ±è¨ˆï¼ˆ10/7 - 10/13ï¼‰

  ã‚¿ã‚¹ã‚¯å®Œäº†ç‡: 85% (17/20ä»¶)

  ãƒ¡ãƒ³ãƒãƒ¼åˆ¥å®Œäº†æ•°:
  - é‡å£å‡œ: 6ä»¶
  - ç”°ä¸­å¤ªéƒ: 5ä»¶
  - ä½è—¤èŠ±å­: 6ä»¶

  ãƒãƒ³ãƒ‰ã‚ªãƒ•å›æ•°: 3ä»¶
  å¹³å‡ã‚¿ã‚¹ã‚¯æ‰€è¦æ™‚é–“: 4.2æ™‚é–“
```

## Functional Requirements

### FR-1: Team Hub Use Cases

- `QueryTeamTasksUseCase`: ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§
- `DetectBottleneckUseCase`: ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡º
- `QueryTeamStatsUseCase`: ãƒãƒ¼ãƒ çµ±è¨ˆå–å¾—

### FR-2: Admin UI

- FastAPI + Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- REST API: `/api/team/tasks`, `/api/team/handoffs`, `/api/team/stats`
- èªè¨¼: Slack OAuth

### FR-3: Bottleneck Detection Logic

```python
async def detect_bottlenecks() -> list[Bottleneck]:
    """ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡º

    Returns:
        æ¤œå‡ºã•ã‚ŒãŸãƒœãƒˆãƒ«ãƒãƒƒã‚¯ä¸€è¦§
    """
    bottlenecks = []

    # 1. ã‚¿ã‚¹ã‚¯é›†ä¸­æ¤œå‡ºï¼ˆ5ä»¶ä»¥ä¸Šï¼‰
    user_task_counts = await task_repository.count_by_user()
    for user_id, count in user_task_counts.items():
        if count >= 5:
            bottlenecks.append(Bottleneck(
                type="task_concentration",
                user_id=user_id,
                severity="high",
                message=f"{user_id}ã«ã‚¿ã‚¹ã‚¯ãŒé›†ä¸­ï¼ˆ{count}ä»¶ï¼‰",
            ))

    # 2. æœŸé™åˆ‡ã‚Œã‚¿ã‚¹ã‚¯æ¤œå‡º
    overdue_tasks = await task_repository.list_overdue()
    if overdue_tasks:
        bottlenecks.append(Bottleneck(
            type="overdue_tasks",
            severity="high",
            message=f"æœŸé™åˆ‡ã‚Œã‚¿ã‚¹ã‚¯: {len(overdue_tasks)}ä»¶",
            tasks=overdue_tasks,
        ))

    # 3. é•·æœŸåœæ»ã‚¿ã‚¹ã‚¯æ¤œå‡ºï¼ˆ3æ—¥ä»¥ä¸Šæ›´æ–°ãªã—ï¼‰
    stale_tasks = await task_repository.list_stale(days=3)
    if stale_tasks:
        bottlenecks.append(Bottleneck(
            type="stale_tasks",
            severity="medium",
            message=f"é•·æœŸåœæ»ã‚¿ã‚¹ã‚¯: {len(stale_tasks)}ä»¶",
            tasks=stale_tasks,
        ))

    return bottlenecks
```

## Non-Functional Requirements

### NFR-1: Performance
- ãƒãƒ¼ãƒ å…¨ä½“ã‚¿ã‚¹ã‚¯å–å¾—: 500msä»¥å†…
- Admin UIèª­ã¿è¾¼ã¿: 1ç§’ä»¥å†…
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡º: 500msä»¥å†…

### NFR-2: Scalability
- 10äººã®ãƒãƒ¼ãƒ ã¾ã§å¯¾å¿œ
- 100ã‚¿ã‚¹ã‚¯ã¾ã§å¯¾å¿œ

### NFR-3: Security
- Admin UIã¯Slack OAuthã§èªè¨¼
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼

## Success Metrics

### Phase 4å®Œäº†åŸºæº–

1. **Team Hub**:
   - [ ] ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡ºãŒå‹•ä½œã™ã‚‹

2. **Admin UI**:
   - [ ] Web UIãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] ã‚¿ã‚¹ã‚¯ä¸€è¦§ãƒ»ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã‚‹

3. **Statistics**:
   - [ ] é€±æ¬¡çµ±è¨ˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] ãƒ¡ãƒ³ãƒãƒ¼åˆ¥å®Œäº†æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹

4. **Performance**:
   - [ ] ãƒãƒ¼ãƒ å…¨ä½“ã‚¿ã‚¹ã‚¯å–å¾—: 500msä»¥å†…
   - [ ] Admin UIèª­ã¿è¾¼ã¿: 1ç§’ä»¥å†…

## Out of Scope (v4.0ã§ã¯å®Ÿè£…ã—ãªã„)

- âŒ ã‚«ã‚¹ã‚¿ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆCSV/Excelï¼‰
- âŒ é€šçŸ¥è¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- âŒ Multi-workspaceå¯¾å¿œ

**Phase 4ã®ã‚¹ã‚³ãƒ¼ãƒ—**: Team Hub + Admin UI + çµ±è¨ˆã®ã¿
